map $microsite $micro_backend {
  include /etc/nginx/sites.map;
}

map $toplevel $backend {
  include /etc/nginx/sites.map;
}

# ####
# These are upstream so we don't need to adjust the configuration
#
upstream media {
<% elems = ENV['BACKEND_W3_MEDIA'] || "ist-w3-media-#{ENV['LANDSCAPE']}.bu.edu:481" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream content {
<% elems = ENV['BACKEND_W3_CONTENT'] || "ist-w3-content-#{ENV['LANDSCAPE']}.bu.edu:381" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream wpassets {
<% elems = ENV['BACKEND_WP_CONTENT'] || "ist-wp-assets-#{ENV['LANDSCAPE']}.bu.edu" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream wpapp {
<% elems = ENV['BACKEND_WP_APP'] || "ist-wp-app-#{ENV['LANDSCAPE']}.bu.edu" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream dbin {
<% elems = ENV['BACKEND_DBIN'] || "dbin-#{ENV['LANDSCAPE']}.bu.edu" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream phpbin {
<% elems = ENV['BACKEND_PHPBIN'] || "phpbin-#{ENV['LANDSCAPE']}.bu.edu" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream degree-advice {
<% elems = ENV['BACKEND_DEGREE_ADVICE'] || "degree-advice-#{ENV['LANDSCAPE']}.bu.edu" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

upstream django {
<% elems = ENV['BACKEND_DJANGO'] || "django-#{ENV['LANDSCAPE']}.bu.edu" %>
<% elems.split(' ').each do |elem| %>
  server <%= elem %> ; <% end %>
}

